<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–ú–ö: –£–º–Ω–∞—è –∫–∞—Å—Å–∞</title>
    <style>
        :root {
            --primary: #6a5acd;
            --primary-light: rgba(106, 90, 205, 0.2);
            --primary-dark: #483d8b;
            --secondary: #9370db;
            --light: rgba(255, 255, 255, 0.8);
            --dark: #2f2f2f;
            --darker: #1a1a1a;
            --success: #00fa9a;
            --success-light: rgba(0, 250, 154, 0.2);
            --danger: #ff69b4;
            --danger-light: rgba(255, 105, 180, 0.2);
            --warning: #ffa500;
            --warning-light: rgba(255, 165, 0, 0.2);
            --info: #00bfff;
            --info-light: rgba(0, 191, 255, 0.2);
            --bg-gradient: linear-gradient(135deg, rgba(106, 90, 205, 0.1) 0%, rgba(147, 112, 219, 0.1) 100%);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 12px 40px rgba(0, 0, 0, 0.15);
            --radius: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --blur: blur(10px);
            --border-light: 1px solid rgba(255, 255, 255, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            position: relative;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: var(--border-light);
            padding: 30px;
            margin-bottom: 20px;
        }

        .sale-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: var(--border-light);
            padding: 30px;
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 30px;
            font-weight: 700;
            font-size: 2.5rem;
            position: relative;
            padding-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        h2, h3, h4 {
            color: var(--primary);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--radius-sm);
            padding: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: var(--border-light);
        }

        .tab {
            padding: 14px 24px;
            cursor: pointer;
            border-radius: var(--radius-sm);
            font-weight: 500;
            transition: var(--transition);
            flex: 1;
            text-align: center;
            color: var(--dark);
            position: relative;
            overflow: hidden;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(106, 90, 205, 0.3);
            font-weight: 600;
        }

        .tab:hover:not(.active) {
            background: rgba(106, 90, 205, 0.1);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        input, button, select {
            padding: 15px 18px;
            border: 1px solid rgba(106, 90, 205, 0.2);
            border-radius: var(--radius-sm);
            font-size: 16px;
            transition: var(--transition);
            font-family: inherit;
        }

        input {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
        }

        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.2);
            outline: none;
            background: rgba(255, 255, 255, 0.9);
        }

        button {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            border: none;
            font-weight: 500;
            min-width: 140px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(106, 90, 205, 0.3);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
        }

        button:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: rgba(147, 112, 219, 0.8);
        }

        button.secondary:hover {
            background: rgba(147, 112, 219, 1);
        }

        button.danger {
            background: linear-gradient(135deg, var(--danger), #ff1493);
        }

        button.danger:hover {
            background: linear-gradient(135deg, #ff1493, var(--danger));
        }

        button.warning {
            background: linear-gradient(135deg, var(--warning), #ff8c00);
        }

        button.warning:hover {
            background: linear-gradient(135deg, #ff8c00, var(--warning));
        }

        button.success {
            background: linear-gradient(135deg, var(--success), #00e676);
        }

        button.success:hover {
            background: linear-gradient(135deg, #00e676, var(--success));
        }

        button.info {
            background: linear-gradient(135deg, var(--info), #1e90ff);
        }

        button.info:hover {
            background: linear-gradient(135deg, #1e90ff, var(--info));
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            border: var(--border-light);
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(106, 90, 205, 0.1);
        }

        th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 500;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: rgba(106, 90, 205, 0.05);
        }

        tr:last-child td {
            border-bottom: none;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px dashed rgba(106, 90, 205, 0.2);
            align-items: center;
            transition: var(--transition);
        }

        .cart-item:hover {
            background: rgba(106, 90, 205, 0.03);
        }

        .total {
            font-weight: 700;
            font-size: 1.6rem;
            margin-top: 25px;
            text-align: right;
            color: var(--primary);
            padding: 20px 0;
            border-top: 2px solid var(--primary);
        }

        #barcode-input {
            font-size: 16px;
            flex: 1;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--primary);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
        }

        .payment-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px dashed rgba(106, 90, 205, 0.2);
        }

        .cash-info {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: var(--border-light);
        }

        .cash-info h4 {
            margin-bottom: 15px;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cash-info p {
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
        }

        .file-import-export {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 2px 8px rgba(106, 90, 205, 0.2);
        }

        .shift-controls {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .backup-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--primary);
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid rgba(106, 90, 205, 0.2);
            border-radius: var(--radius-sm);
            margin-top: 5px;
            display: none;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            position: absolute;
            width: calc(100% - 120px);
            z-index: 10;
        }

        .search-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(106, 90, 205, 0.1);
            transition: var(--transition);
        }

        .search-item:hover {
            background-color: rgba(106, 90, 205, 0.05);
        }

        .search-item:last-child {
            border-bottom: none;
        }

        .shift-section {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            padding: 25px;
            border-radius: var(--radius);
            margin-top: 40px;
            box-shadow: var(--shadow);
            border: var(--border-light);
        }

        .report-item {
            padding: 20px;
            border-bottom: 1px solid rgba(106, 90, 205, 0.1);
            cursor: pointer;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            border: var(--border-light);
        }

        .report-item:hover {
            background-color: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .withdraw-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed rgba(106, 90, 205, 0.2);
        }

        .catalog-search {
            margin-bottom: 20px;
        }

        .search-wrapper {
            position: relative;
            flex: 1;
        }

        .highlight {
            background-color: rgba(255, 242, 172, 0.5);
            background-image: linear-gradient(to right, rgba(255, 227, 89, 0.3) 0%, rgba(255, 242, 172, 0.3) 100%);
            padding: 2px 4px;
            border-radius: 3px;
        }

        .floating-change {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--success), #00e676);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: 0 10px 30px rgba(0, 250, 154, 0.3);
            display: none;
            z-index: 100;
            animation: pulse 2s infinite;
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border-light);
        }

        .shift-status {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .shift-status.active {
            background: var(--success-light);
            color: var(--success);
            border: 1px solid rgba(0, 250, 154, 0.3);
        }

        .shift-status.inactive {
            background: var(--danger-light);
            color: var(--danger);
            border: 1px solid rgba(255, 105, 180, 0.3);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 250, 154, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 250, 154, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 250, 154, 0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in-up {
            animation: fadeInUp 0.5s forwards;
        }

        @media (max-width: 768px) {
            .container { padding: 0; }
            .tabs { flex-wrap: wrap; }
            .tab { flex: 1 0 45%; margin-bottom: 5px; }
            .input-group { flex-wrap: wrap; }
            input, button { width: 100%; }
            .search-results { width: 100%; }
        }

        .neon-text {
            text-shadow: 0 0 5px rgba(106, 90, 205, 0.3), 0 0 10px rgba(106, 90, 205, 0.2);
        }

        .neon-border {
            box-shadow: 0 0 10px rgba(106, 90, 205, 0.2), inset 0 0 10px rgba(106, 90, 205, 0.1);
        }

        .neon-card {
            box-shadow: 0 0 15px rgba(106, 90, 205, 0.2), 0 0 30px rgba(106, 90, 205, 0.1);
        }

        .save-status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            background: var(--success);
            color: white;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .save-status.visible { opacity: 1; }

        .data-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .data-controls button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="neon-text">–†–ú–ö: –£–º–Ω–∞—è –∫–∞—Å—Å–∞</h1>
        
        <div class="data-controls">
            <button onclick="saveData()" class="info">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="loadData()" class="info">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="exportData()" class="secondary">–≠–∫—Å–ø–æ—Ä—Ç</button>
            <button onclick="importData()" class="secondary">–ò–º–ø–æ—Ä—Ç</button>
        </div>
        
        <div class="tabs neon-border">
            <div class="tab active" data-tab="sale">–ü—Ä–æ–¥–∞–∂–∏</div>
            <div class="tab" data-tab="catalog">–ö–∞—Ç–∞–ª–æ–≥</div>
            <div class="tab" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</div>
            <div class="tab" data-tab="reports">–û—Ç—á–µ—Ç—ã</div>
        </div>
        
        <div id="sale" class="tab-content active">
            <div class="sale-panel neon-card">
                <div class="input-group">
                    <div class="search-wrapper">
                        <input type="text" id="barcode-input" placeholder="–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" autofocus>
                        <div id="search-results" class="search-results"></div>
                    </div>
                </div>
                
                <div id="current-cart">
                    <h3>–¢–µ–∫—É—â–∏–π —á–µ–∫</h3>
                    <div id="cart-items"></div>
                    <div class="total">–ò—Ç–æ–≥–æ: <span id="total">0</span> ‚ÇΩ</div>
                </div>
                
                <div class="payment-section">
                    <div class="input-group">
                        <input type="number" id="cash" placeholder="–í–Ω–µ—Å—ë–Ω–Ω–∞—è —Å—É–º–º–∞" min="0">
                        <button id="complete-sale" class="success">–ü—Ä–æ–±–∏—Ç—å —á–µ–∫</button>
                    </div>
                    <div id="change-result" style="margin-top: 15px; font-weight: 600;"></div>
                </div>
            </div>
            
            <div class="shift-section neon-card">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π</h3>
                <div class="input-group">
                    <input type="number" id="cash-amount" placeholder="–°—É–º–º–∞ –Ω–∞ –Ω–∞—á–∞–ª–æ —Å–º–µ–Ω—ã" min="0">
                    <div class="shift-controls">
                        <button id="start-shift" class="success">–ù–∞—á–∞—Ç—å —Å–º–µ–Ω—É</button>
                        <button id="end-shift" class="danger">–ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É</button>
                    </div>
                </div>
                
                <div class="withdraw-section">
                    <h4>–í—ã–µ–º–∫–∞ –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤</h4>
                    <div class="input-group">
                        <input type="number" id="withdraw-amount" placeholder="–°—É–º–º–∞ –≤—ã–µ–º–∫–∏" min="0">
                        <button id="withdraw-cash" class="warning">–í—ã–≤–µ—Å—Ç–∏ –¥–µ–Ω—å–≥–∏</button>
                    </div>
                </div>
                
                <div class="cash-info">
                    <h4><i class="icon">üí∞</i> –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Å—Å—ã:</h4>
                    <p><span>–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞:</span> <span id="display-start-cash">0</span> ‚ÇΩ</p>
                    <p><span>–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–º–µ–Ω—É:</span> <span id="display-sales-total">0</span> ‚ÇΩ</p>
                    <p><span>–í—ã–µ–º–∫–∏ –∑–∞ —Å–º–µ–Ω—É:</span> <span id="display-withdrawals">0</span> ‚ÇΩ</p>
                    <p><span>–ò—Ç–æ–≥–æ –≤ –∫–∞—Å—Å–µ:</span> <span id="display-total-cash">0</span> ‚ÇΩ</p>
                    <p><span>–°—Ç–∞—Ç—É—Å:</span> <span id="current-shift-status" class="shift-status inactive">–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞</span></p>
                </div>
            </div>
        </div>
        
        <div id="catalog" class="tab-content glass-panel">
            <div class="catalog-search">
                <div class="input-group">
                    <input type="text" id="catalog-search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É">
                </div>
            </div>
            
            <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            <div class="input-group">
                <input type="text" id="product-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                <input type="text" id="product-barcode" placeholder="–®—Ç—Ä–∏—Ö-–∫–æ–¥">
                <input type="number" id="product-price" placeholder="–¶–µ–Ω–∞" min="0">
                <button id="add-product">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            
            <h3>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h3>
            <table id="products-table">
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                        <th>–¶–µ–Ω–∞ (‚ÇΩ)</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="products-list"></tbody>
            </table>
        </div>
        
        <div id="history" class="tab-content glass-panel">
            <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂</h3>
            <div class="input-group">
                <input type="date" id="history-date">
                <button id="show-history">–ü–æ–∫–∞–∑–∞—Ç—å</button>
            </div>
            <table id="history-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ß–µ–∫–æ–≤</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–í—ã–µ–º–∫–∏</th>
                        <th>–î–µ—Ç–∞–ª–∏</th>
                    </tr>
                </thead>
                <tbody id="history-list"></tbody>
            </table>
        </div>
        
        <div id="reports" class="tab-content glass-panel">
            <h3>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</h3>
            <div id="reports-list" style="margin-top: 15px;"></div>
        </div>
    </div>

    <div id="floating-change" class="floating-change"></div>
    <div id="saveStatus" class="save-status">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const APP_CONFIG = {
  GITHUB_USER: "musclebar-work",
  REPO_NAME: "rmk",
  DATA_FILE: "data.json",
  GITHUB_TOKEN: "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", // –í–Ω–∏–º–∞–Ω–∏–µ! –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω
  LOCAL_STORAGE_KEY: "rmk-pos-data",
  DEFAULT_CASH_REGISTER: {
    startAmount: 0,
    salesTotal: 0,
    withdrawals: 0,
    isShiftActive: false,
    endAmount: null
  }
};

// –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const AppState = {
  products: [],
  receipts: [],
  currentCart: [],
  cashRegister: {...APP_CONFIG.DEFAULT_CASH_REGISTER},
  reports: [],
  withdrawalsHistory: [],
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
  init() {
    this.loadData();
    this.setupEventListeners();
    this.renderAll();
    
    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –≤ –ø–æ–ª–µ –∏—Å—Ç–æ—Ä–∏–∏
    document.getElementById('history-date').valueAsDate = new Date();
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞
    document.getElementById('barcode-input').focus();
  },
  
  // ========== –°–ò–°–¢–ï–ú–ê –•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–• ==========
  prepareData() {
    return {
      products: this.products,
      receipts: this.receipts,
      cashRegister: this.cashRegister,
      reports: this.reports,
      withdrawals: this.withdrawalsHistory,
      lastUpdated: new Date().toISOString()
    };
  },
  
  showSaveStatus() {
    const saveStatus = document.getElementById('saveStatus');
    saveStatus.classList.add('visible');
    setTimeout(() => saveStatus.classList.remove('visible'), 2000);
  },
  
  async saveData() {
    const data = this.prepareData();
    
    // 1. –í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
    localStorage.setItem(APP_CONFIG.LOCAL_STORAGE_KEY, JSON.stringify(data));
    this.showSaveStatus();
    
    // 2. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ GitHub (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å)
    if (APP_CONFIG.GITHUB_TOKEN) {
      try {
        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π SHA —Ñ–∞–π–ª–∞
        let sha = null;
        const getResponse = await fetch(
          `https://api.github.com/repos/${APP_CONFIG.GITHUB_USER}/${APP_CONFIG.REPO_NAME}/contents/${APP_CONFIG.DATA_FILE}`,
          {
            headers: {
              'Authorization': `token ${APP_CONFIG.GITHUB_TOKEN}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );
        
        if (getResponse.ok) {
          const fileInfo = await getResponse.json();
          sha = fileInfo.sha;
        } else if (getResponse.status !== 404) {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + await getResponse.text());
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
        const updateResponse = await fetch(
          `https://api.github.com/repos/${APP_CONFIG.GITHUB_USER}/${APP_CONFIG.REPO_NAME}/contents/${APP_CONFIG.DATA_FILE}`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${APP_CONFIG.GITHUB_TOKEN}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: 'Auto-update from RMK POS',
              content: content,
              sha: sha
            })
          }
        );
        
        if (!updateResponse.ok) {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + await updateResponse.text());
        }
        
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ GitHub');
      } catch (error) {
        console.error('GitHub Error:', error);
        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ GitHub: ' + error.message);
      }
    }
  },
  
  async loadData() {
    // 1. –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
    const localData = localStorage.getItem(APP_CONFIG.LOCAL_STORAGE_KEY);
    if (localData) {
      try {
        const data = JSON.parse(localData);
        this.products = data.products || [];
        this.receipts = data.receipts || [];
        this.cashRegister = data.cashRegister || {...APP_CONFIG.DEFAULT_CASH_REGISTER};
        this.reports = data.reports || [];
        this.withdrawalsHistory = data.withdrawals || [];
        console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage");
      } catch (e) {
        console.log("‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:", e);
      }
    }
    
    // 2. –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ GitHub (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –µ—Å—Ç—å)
    if (APP_CONFIG.GITHUB_TOKEN) {
      try {
        const response = await fetch(
          `https://api.github.com/repos/${APP_CONFIG.GITHUB_USER}/${APP_CONFIG.REPO_NAME}/contents/${APP_CONFIG.DATA_FILE}`,
          {
            headers: {
              'Authorization': `token ${APP_CONFIG.GITHUB_TOKEN}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );
        
        if (response.ok) {
          const fileInfo = await response.json();
          const content = JSON.parse(atob(fileInfo.content));
          
          this.products = content.products || [];
          this.receipts = content.receipts || [];
          this.cashRegister = content.cashRegister || {...APP_CONFIG.DEFAULT_CASH_REGISTER};
          this.reports = content.reports || [];
          this.withdrawalsHistory = content.withdrawals || [];
          console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub");
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –∫–∞–∫ –∫—ç—à
          localStorage.setItem(APP_CONFIG.LOCAL_STORAGE_KEY, JSON.stringify(content));
        }
      } catch (error) {
        console.log("‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ GitHub:", error);
      }
    }
    
    this.renderAll();
  },
  
  exportData() {
    const data = this.prepareData();
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `rmk-backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª!');
  },
  
  importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = e => {
      const file = e.target.files[0];
      const reader = new FileReader();
      
      reader.onload = event => {
        try {
          const data = JSON.parse(event.target.result);
          
          this.products = data.products || [];
          this.receipts = data.receipts || [];
          this.cashRegister = data.cashRegister || {...APP_CONFIG.DEFAULT_CASH_REGISTER};
          this.reports = data.reports || [];
          this.withdrawalsHistory = data.withdrawals || [];
          
          localStorage.setItem(APP_CONFIG.LOCAL_STORAGE_KEY, JSON.stringify(data));
          this.renderAll();
          alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞!');
        } catch (error) {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
        }
      };
      
      reader.readAsText(file);
    };
    
    input.click();
  },
  
  // ========== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
  renderAll() {
    this.renderProducts();
    this.renderHistory();
    this.renderReports();
    this.updateCashDisplay();
  },
  
  switchTab(event) {
    const tabId = event.target.dataset.tab;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabId).classList.add('active');
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —à—Ç—Ä–∏—Ö-–∫–æ–¥–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ø—Ä–æ–¥–∞–∂
    if (tabId === 'sale') {
      document.getElementById('barcode-input').focus();
    }
  },
  
  // ========== –§–£–ù–ö–¶–ò–û–ù–ê–õ –ü–†–û–î–ê–ñ ==========
  searchProducts() {
    const searchTerm = document.getElementById('barcode-input').value.trim().toLowerCase();
    const searchResultsEl = document.getElementById('search-results');
    
    if (searchTerm.length < 1) {
      searchResultsEl.style.display = 'none';
      return;
    }

    const results = this.products.filter(product => 
      product.name.toLowerCase().includes(searchTerm) || 
      product.barcode.includes(searchTerm)
    );

    this.displaySearchResults(results);
  },
  
  displaySearchResults(results) {
    const searchResultsEl = document.getElementById('search-results');
    searchResultsEl.innerHTML = '';
    
    if (results.length === 0) {
      searchResultsEl.style.display = 'none';
      return;
    }

    results.forEach(product => {
      const div = document.createElement('div');
      div.className = 'search-item';
      div.innerHTML = `${product.name} (${product.price} ‚ÇΩ) <span class="badge">${product.barcode}</span>`;
      div.addEventListener('click', () => {
        this.addProductToCart(product.barcode);
        searchResultsEl.style.display = 'none';
      });
      searchResultsEl.appendChild(div);
    });

    searchResultsEl.style.display = 'block';
  },
  
  addProductToCart(barcode = null) {
    const searchTerm = barcode || document.getElementById('barcode-input').value.trim();
    if (!searchTerm) return;
    
    const product = this.products.find(p => 
      p.barcode === searchTerm || 
      p.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    if (product) {
      this.currentCart.push({
        name: product.name,
        price: product.price,
        barcode: product.barcode
      });
      this.renderCart();
      document.getElementById('barcode-input').value = '';
      document.getElementById('search-results').style.display = 'none';
    } else {
      alert('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à—Ç—Ä–∏—Ö-–∫–æ–¥ –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ.');
    }
  },
  
  removeFromCart(index) {
    this.currentCart.splice(index, 1);
    this.renderCart();
  },
  
  renderCart() {
    const cartItemsEl = document.getElementById('cart-items');
    cartItemsEl.innerHTML = '';
    let total = 0;
    
    if (this.currentCart.length === 0) {
      cartItemsEl.innerHTML = '<div style="padding: 20px; text-align: center;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
      document.getElementById('total').textContent = '0';
      return;
    }
    
    this.currentCart.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'cart-item fade-in-up';
      div.innerHTML = `
        <span>${item.name} (${item.price} ‚ÇΩ)</span>
        <button onclick="AppState.removeFromCart(${index})" class="danger">√ó</button>
      `;
      cartItemsEl.appendChild(div);
      total += item.price;
    });
    
    document.getElementById('total').textContent = total;
  },
  
  calculateChange() {
    const total = parseInt(document.getElementById('total').textContent) || 0;
    const cash = parseInt(document.getElementById('cash').value) || 0;
    const changeResultEl = document.getElementById('change-result');
    const floatingChangeEl = document.getElementById('floating-change');
    
    if (cash === 0) {
      changeResultEl.textContent = '';
      floatingChangeEl.style.display = 'none';
      return;
    }
    
    if (cash < total) {
      changeResultEl.textContent = '–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!';
      changeResultEl.style.color = 'var(--danger)';
      floatingChangeEl.style.display = 'none';
    } else {
      const change = cash - total;
      changeResultEl.textContent = `–°–¥–∞—á–∞: ${change} ‚ÇΩ`;
      changeResultEl.style.color = 'var(--success)';
      
      floatingChangeEl.textContent = `–°–¥–∞—á–∞: ${change} ‚ÇΩ`;
      floatingChangeEl.style.display = 'flex';
    }
  },
  
  completeSale() {
    if (!this.cashRegister.isShiftActive) {
      alert('–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞! –û—Ç–∫—Ä–æ–π—Ç–µ —Å–º–µ–Ω—É –≤ –±–ª–æ–∫–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.');
      return;
    }
    
    const total = parseInt(document.getElementById('total').textContent) || 0;
    if (total === 0) {
      alert('–ß–µ–∫ –ø—É—Å—Ç!');
      return;
    }
    
    const cash = parseInt(document.getElementById('cash').value) || 0;
    if (cash < total) {
      alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!');
      return;
    }
    
    const now = new Date();
    const receipt = {
      date: now.toISOString().split('T')[0],
      time: now.toLocaleTimeString(),
      items: [...this.currentCart],
      total: total,
      cashReceived: cash,
      change: cash - total
    };
    
    this.receipts.push(receipt);
    this.cashRegister.salesTotal += total;
    this.saveData();
    
    this.currentCart = [];
    this.renderCart();
    document.getElementById('cash').value = '';
    document.getElementById('change-result').textContent = '';
    document.getElementById('floating-change').style.display = 'none';
    
    this.renderHistory();
  },
  
  // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ú–ï–ù–û–ô ==========
  startShift() {
    const amount = parseInt(document.getElementById('cash-amount').value) || 0;
    if (amount <= 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!');
      return;
    }
    
    this.cashRegister = {
      startAmount: amount,
      salesTotal: 0,
      withdrawals: 0,
      isShiftActive: true,
      endAmount: null
    };
    
    this.saveData();
    this.updateCashDisplay();
    document.getElementById('cash-amount').value = '';
  },
  
  endShift() {
    if (!this.cashRegister.isShiftActive) {
      alert('–°–º–µ–Ω–∞ —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞!');
      return;
    }
    
    const endAmount = this.cashRegister.startAmount + this.cashRegister.salesTotal - this.cashRegister.withdrawals;
    this.cashRegister.isShiftActive = false;
    this.cashRegister.endAmount = endAmount;
    
    const now = new Date();
    const report = {
      date: now.toISOString().split('T')[0],
      time: now.toLocaleTimeString(),
      startAmount: this.cashRegister.startAmount,
      salesTotal: this.cashRegister.salesTotal,
      withdrawals: this.cashRegister.withdrawals,
      endAmount: endAmount,
      receipts: this.receipts.filter(r => r.date === now.toISOString().split('T')[0]),
      withdrawalsHistory: this.withdrawalsHistory.filter(w => w.date === now.toISOString().split('T')[0])
    };
    
    this.reports.push(report);
    this.saveData();
    
    this.cashRegister = {...APP_CONFIG.DEFAULT_CASH_REGISTER};
    this.updateCashDisplay();
    this.renderReports();
  },
  
  withdrawCash() {
    if (!this.cashRegister.isShiftActive) {
      alert('–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞!');
      return;
    }
    
    const amount = parseInt(document.getElementById('withdraw-amount').value) || 0;
    if (amount <= 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É!');
      return;
    }
    
    const totalCash = this.cashRegister.startAmount + this.cashRegister.salesTotal - this.cashRegister.withdrawals;
    if (amount > totalCash) {
      alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –∫–∞—Å—Å–µ!');
      return;
    }
    
    this.cashRegister.withdrawals += amount;
    
    const now = new Date();
    this.withdrawalsHistory.push({
      date: now.toISOString().split('T')[0],
      time: now.toLocaleTimeString(),
      amount: amount,
      comment: '–í—ã–µ–º–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤'
    });
    
    this.saveData();
    this.updateCashDisplay();
    document.getElementById('withdraw-amount').value = '';
  },
  
  updateCashDisplay() {
    const totalCash = this.cashRegister.startAmount + this.cashRegister.salesTotal - this.cashRegister.withdrawals;
    const currentShiftStatusEl = document.getElementById('current-shift-status');
    
    if (this.cashRegister.isShiftActive) {
      currentShiftStatusEl.textContent = '–°–º–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞';
      currentShiftStatusEl.className = 'shift-status active';
    } else {
      currentShiftStatusEl.textContent = '–°–º–µ–Ω–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞';
      currentShiftStatusEl.className = 'shift-status inactive';
    }
    
    document.getElementById('display-start-cash').textContent = this.cashRegister.startAmount;
    document.getElementById('display-sales-total').textContent = this.cashRegister.salesTotal;
    document.getElementById('display-withdrawals').textContent = this.cashRegister.withdrawals;
    document.getElementById('display-total-cash').textContent = totalCash;
  },
  
  // ========== –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–û–í ==========
  searchInCatalog() {
    const searchTerm = document.getElementById('catalog-search-input').value.trim().toLowerCase();
    if (!searchTerm) {
      this.renderProducts();
      return;
    }

    const filteredProducts = this.products.filter(product => 
      product.name.toLowerCase().includes(searchTerm) || 
      product.barcode.toLowerCase().includes(searchTerm)
    );

    this.renderProducts(filteredProducts);
  },
  
  addNewProduct() {
    const name = document.getElementById('product-name').value.trim();
    const barcode = document.getElementById('product-barcode').value.trim();
    const price = parseInt(document.getElementById('product-price').value) || 0;
    
    if (!name || !barcode || price <= 0) {
      alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
      return;
    }
    
    if (this.products.some(p => p.barcode === barcode)) {
      alert('–¢–æ–≤–∞—Ä —Å —Ç–∞–∫–∏–º —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!');
      return;
    }
    
    this.products.push({ name, barcode, price });
    this.saveData();
    
    document.getElementById('product-name').value = '';
    document.getElementById('product-barcode').value = '';
    document.getElementById('product-price').value = '';
    this.renderProducts();
  },
  
  renderProducts(productsToRender = this.products) {
    const productsListEl = document.getElementById('products-list');
    productsListEl.innerHTML = '';
    
    if (productsToRender.length === 0) {
      productsListEl.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>';
      return;
    }
    
    productsToRender.forEach((product, index) => {
      const tr = document.createElement('tr');
      tr.className = 'fade-in-up';
      tr.innerHTML = `
        <td>${product.name}</td>
        <td><span class="badge">${product.barcode}</span></td>
        <td>${product.price} ‚ÇΩ</td>
        <td>
          <button onclick="AppState.deleteProduct(${index})" class="danger">–£–¥–∞–ª–∏—Ç—å</button>
        </td>
      `;
      productsListEl.appendChild(tr);
    });
  },
  
  deleteProduct(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
      this.products.splice(index, 1);
      this.saveData();
      this.renderProducts();
    }
  },
  
  // ========== –ò–°–¢–û–†–ò–Ø –ü–†–û–î–ê–ñ ==========
  renderHistory() {
    const date = document.getElementById('history-date').value;
    const groupedByDate = {};
    
    this.receipts.forEach(receipt => {
      if (!groupedByDate[receipt.date]) {
        groupedByDate[receipt.date] = {
          count: 0,
          total: 0,
          receipts: []
        };
      }
      groupedByDate[receipt.date].count++;
      groupedByDate[receipt.date].total += receipt.total;
      groupedByDate[receipt.date].receipts.push(receipt);
    });
    
    const withdrawalsByDate = {};
    this.withdrawalsHistory.forEach(withdrawal => {
      if (!withdrawalsByDate[withdrawal.date]) {
        withdrawalsByDate[withdrawal.date] = 0;
      }
      withdrawalsByDate[withdrawal.date] += withdrawal.amount;
    });
    
    const historyListEl = document.getElementById('history-list');
    historyListEl.innerHTML = '';
    
    if (Object.keys(groupedByDate).length === 0) {
      historyListEl.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö</td></tr>';
      return;
    }
    
    Object.entries(groupedByDate).forEach(([date, data]) => {
      const tr = document.createElement('tr');
      tr.className = 'fade-in-up';
      tr.innerHTML = `
        <td>${date}</td>
        <td>${data.count}</td>
        <td>${data.total} ‚ÇΩ</td>
        <td>${withdrawalsByDate[date] || 0} ‚ÇΩ</td>
        <td><button onclick="AppState.showReceiptsDetails('${date}')">–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏</button></td>
      `;
      historyListEl.appendChild(tr);
    });
  },
  
  showReceiptsDetails(date) {
    const dailyReceipts = this.receipts.filter(r => r.date === date);
    const dailyWithdrawals = this.withdrawalsHistory.filter(w => w.date === date);
    
    let details = `–î–µ—Ç–∞–ª–∏ –∑–∞ ${date}:\n\n`;
    details += `=== –ü—Ä–æ–¥–∞–∂–∏ ===\n`;
    details += `–í—Å–µ–≥–æ —á–µ–∫–æ–≤: ${dailyReceipts.length}\n`;
    details += `–û–±—â–∞—è —Å—É–º–º–∞: ${dailyReceipts.reduce((sum, r) => sum + r.total, 0)} ‚ÇΩ\n\n`;
    
    dailyReceipts.forEach((r, i) => {
      details += `–ß–µ–∫ #${i + 1} (${r.time}): ${r.total} ‚ÇΩ\n`;
      r.items.forEach(item => {
        details += `- ${item.name}: ${item.price} ‚ÇΩ\n`;
      });
      details += '\n';
    });
    
    if (dailyWithdrawals.length > 0) {
      details += `=== –í—ã–µ–º–∫–∏ ===\n`;
      details += `–í—Å–µ–≥–æ –≤—ã–µ–º–æ–∫: ${dailyWithdrawals.length}\n`;
      details += `–û–±—â–∞—è —Å—É–º–º–∞: ${dailyWithdrawals.reduce((sum, w) => sum + w.amount, 0)} ‚ÇΩ\n\n`;
      
      dailyWithdrawals.forEach((w, i) => {
        details += `–í—ã–µ–º–∫–∞ #${i + 1} (${w.time}): ${w.amount} ‚ÇΩ\n`;
      });
    }
    
    alert(details);
  },
  
  // ========== –û–¢–ß–ï–¢–´ ==========
  renderReports() {
    const reportsListEl = document.getElementById('reports-list');
    reportsListEl.innerHTML = '';
    
    if (this.reports.length === 0) {
      reportsListEl.innerHTML = '<div style="padding: 15px; text-align: center;">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</div>';
      return;
    }
    
    this.reports.forEach((report, index) => {
      const div = document.createElement('div');
      div.className = 'report-item fade-in-up';
      div.innerHTML = `
        <div><strong>–û—Ç—á–µ—Ç –∑–∞ ${report.date}</strong></div>
        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
          <div>
            <div>–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: <strong>${report.startAmount} ‚ÇΩ</strong></div>
            <div>–ü—Ä–æ–¥–∞–∂–∏: <strong>${report.salesTotal} ‚ÇΩ</strong></div>
          </div>
          <div>
            <div>–í—ã–µ–º–∫–∏: <strong>${report.withdrawals || 0} ‚ÇΩ</strong></div>
            <div>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞: <strong>${report.endAmount} ‚ÇΩ</strong></div>
          </div>
        </div>
        <button onclick="AppState.viewReportDetails(${index})" style="margin-top: 10px; width: 100%;">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
      `;
      reportsListEl.appendChild(div);
    });
  },
  
  viewReportDetails(index) {
    const report = this.reports[index];
    let details = `–û—Ç—á–µ—Ç –∑–∞ ${report.date}\n\n`;
    details += `–ù–∞—á–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: ${report.startAmount} ‚ÇΩ\n`;
    details += `–ü—Ä–æ–¥–∞–∂–∏ –∑–∞ —Å–º–µ–Ω—É: ${report.salesTotal} ‚ÇΩ\n`;
    details += `–í—ã–µ–º–∫–∏ –∑–∞ —Å–º–µ–Ω—É: ${report.withdrawals || 0} ‚ÇΩ\n`;
    details += `–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞: ${report.endAmount} ‚ÇΩ\n\n`;
    details += `–ß–µ–∫–æ–≤ –∑–∞ —Å–º–µ–Ω—É: ${report.receipts.length}\n`;
    details += `–í—ã–µ–º–æ–∫ –∑–∞ —Å–º–µ–Ω—É: ${report.withdrawalsHistory?.length || 0}\n`;
    
    alert(details);
  },
  
  // ========== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ==========
  setupEventListeners() {
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll('.tab').forEach(tab => 
      tab.addEventListener('click', (e) => this.switchTab(e))
    );
    
    // –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
    document.getElementById('add-product').addEventListener('click', () => this.addNewProduct());
    document.getElementById('catalog-search-input').addEventListener('input', () => this.searchInCatalog());
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ–Ω–æ–π
    document.getElementById('start-shift').addEventListener('click', () => this.startShift());
    document.getElementById('end-shift').addEventListener('click', () => this.endShift());
    document.getElementById('withdraw-cash').addEventListener('click', () => this.withdrawCash());
    
    // –ü—Ä–æ–¥–∞–∂–∏
    document.getElementById('complete-sale').addEventListener('click', () => this.completeSale());
    document.getElementById('barcode-input').addEventListener('input', () => this.searchProducts());
    document.getElementById('cash').addEventListener('input', () => this.calculateChange());
    
    // –ò—Å—Ç–æ—Ä–∏—è
    document.getElementById('show-history').addEventListener('click', () => this.renderHistory());
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
    document.querySelector('button[onclick="saveData()"]').addEventListener('click', () => this.saveData());
    document.querySelector('button[onclick="loadData()"]').addEventListener('click', () => this.loadData());
    document.querySelector('button[onclick="exportData()"]').addEventListener('click', () => this.exportData());
    document.querySelector('button[onclick="importData()"]').addEventListener('click', () => this.importData());
  }
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  AppState.init();
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ HTML
window.saveData = () => AppState.saveData();
window.loadData = () => AppState.loadData();
window.exportData = () => AppState.exportData();
window.importData = () => AppState.importData();
window.deleteProduct = (index) => AppState.deleteProduct(index);
window.removeFromCart = (index) => AppState.removeFromCart(index);
window.showReceiptsDetails = (date) => AppState.showReceiptsDetails(date);
window.viewReportDetails = (index) => AppState.viewReportDetails(index);
    </script>
</body>
</html>

